<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laporan Absensi - Sampan Ajie Pratomo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .profile-gradient {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Header & Profile Section -->
    <div class="profile-gradient text-white pb-24">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-10">
            <div class="flex flex-col md:flex-row items-center gap-8">
                <!-- Profile Image -->
                <div class="relative group">
                    <div class="absolute -inset-1 bg-gradient-to-r from-red-600 to-pink-600 rounded-full blur opacity-75 group-hover:opacity-100 transition duration-1000 group-hover:duration-200"></div>
                    <img src="Profil.SampanAjie.png" alt="" class="relative w-40 h-40 rounded-full border-4 border-white object-cover shadow-2xl">
                </div>
                
                <!-- Info Pegawai -->
                <div class="text-center md:text-left flex-1">
                    <h1 class="text-3xl font-bold mb-1">Sampan Ajie Pratomo</h1>
                    <p class="text-red-400 font-semibold mb-2">Pokja Persyaratan Dasar Perijinan Berusaha</p>
                    <p class="text-slate-300 text-sm mb-4">DPMPTSP Kota Tangerang Selatan</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-slate-300 bg-white/10 p-4 rounded-lg backdrop-blur-sm max-w-xl">
                        <div>
                            <span class="block text-xs text-slate-400">Ketua Pokja PDPB</span>
                            <span class="font-medium text-white">Lucky Trisyahnura</span>
                        </div>
                        <div>
                            <span class="block text-xs text-slate-400">Kepala Dinas</span>
                            <span class="font-medium text-white">H. Maulana Prayoga</span>
                        </div>
                    </div>
                </div>

                <!-- Action Button -->
                <div class="mt-4 md:mt-0">
                    <a href="https://wa.me/6282121419778" target="_blank" class="inline-flex items-center gap-2 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition transform hover:-translate-y-1">
                        <i class="fab fa-whatsapp text-2xl"></i>
                        <div class="text-left leading-tight">
                            <span class="block text-xs font-normal opacity-90">Hubungi via WhatsApp</span>
                            <span class="block">Mas Ajie</span>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 -mt-16 pb-10">
        
        <!-- Summary Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
            <div class="glass-panel p-6 rounded-xl border-l-4 border-blue-500">
                <p class="text-sm text-slate-500">Total Hari Kerja</p>
                <p class="text-2xl font-bold" id="totalDays">0</p>
            </div>
            <div class="glass-panel p-6 rounded-xl border-l-4 border-green-500">
                <p class="text-sm text-slate-500">Rata-rata Jam Masuk</p>
                <p class="text-2xl font-bold" id="avgIn">00:00</p>
            </div>
            <div class="glass-panel p-6 rounded-xl border-l-4 border-orange-500">
                <p class="text-sm text-slate-500">Rata-rata Jam Pulang</p>
                <p class="text-2xl font-bold" id="avgOut">00:00</p>
            </div>
            <div class="glass-panel p-6 rounded-xl border-l-4 border-purple-500">
                <p class="text-sm text-slate-500">Avg Durasi Kerja</p>
                <p class="text-2xl font-bold" id="avgDuration">0 Jam</p>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Chart 1: Pola Kedatangan & Kepulangan -->
            <div class="glass-panel p-6 rounded-xl bg-white">
                <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                    <i class="fas fa-chart-line text-blue-600"></i> Pola Waktu Masuk & Pulang
                </h3>
                <div class="relative h-72">
                    <canvas id="timeChart"></canvas>
                </div>
            </div>

            <!-- Chart 2: Durasi Kerja -->
            <div class="glass-panel p-6 rounded-xl bg-white">
                <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                    <i class="fas fa-stopwatch text-purple-600"></i> Durasi Jam Kerja (Per Hari)
                </h3>
                <div class="relative h-72">
                    <canvas id="durationChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Analysis Text Section -->
        <div class="glass-panel p-8 rounded-xl bg-white mb-8">
            <h3 class="text-xl font-bold mb-6 text-slate-800 border-b pb-2">Analisa & Laporan Manual Backup</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Analisa Kedisiplinan -->
                <div>
                    <h4 class="font-bold text-blue-700 mb-2">1. Analisa Kedisiplinan & Kinerja</h4>
                    <ul class="list-disc list-inside space-y-2 text-sm text-slate-600">
                        <li><strong>Konsistensi Datang Pagi:</strong> Data menunjukkan pola kedatangan yang sangat konsisten, mayoritas antara pukul <span class="font-mono bg-blue-100 px-1 rounded">06:15 - 06:30</span>. Ini menunjukkan dedikasi tinggi untuk memulai pekerjaan lebih awal dari jam operasional standar.</li>
                        <li><strong>Durasi Kerja Panjang:</strong> Rata-rata jam pulang berada di atas pukul 19:00 WIB. Terdapat kejadian lembur ekstrem pada tanggal 28 November (pulang dini hari 01:31) dan 7 November (pulang 22:00), menandakan beban kerja atau penyelesaian tugas yang intensif.</li>
                        <li><strong>Integritas Data:</strong> Seluruh data didukung oleh bukti visual (foto timestamp mesin) yang tidak dapat dimanipulasi, memastikan validitas kehadiran fisik di kantor.</li>
                    </ul>
                </div>

                <!-- Justifikasi Backup -->
                <div>
                    <h4 class="font-bold text-red-600 mb-2">2. Laporan Kendala & Backup Manual</h4>
                    <div class="bg-red-50 p-4 rounded-lg border border-red-100">
                        <p class="text-sm text-slate-700 mb-3 text-justify">
                            <strong>Isu Utama:</strong> Mesin absensi sidik jari (fingerprint) di lokasi mengalami error intermiten/berkala yang menyebabkan kegagalan pencatatan log digital secara otomatis ke server.
                        </p>
                        <p class="text-sm text-slate-700 text-justify">
                            <strong>Solusi Backup (Prosedur Saat Ini):</strong>
                            Sebagai langkah mitigasi risiko hilangnya data kehadiran, pegawai (Sdr. Sampan Ajie) melakukan dokumentasi manual berupa <strong>foto timestamp real-time</strong> pada layar mesin saat kedatangan dan kepulangan. Foto-foto ini (terlampir dalam tabel di bawah) berfungsi sebagai audit trail sah dan bukti fisik kehadiran untuk keperluan administrasi kepegawaian.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="glass-panel rounded-xl overflow-hidden bg-white">
            <div class="p-6 border-b flex justify-between items-center bg-gray-50">
                <h3 class="text-lg font-bold">Log Data Absensi (Transkripsi Foto)</h3>
                <span class="text-xs font-mono bg-gray-200 px-2 py-1 rounded text-gray-600">Periode: Okt - Nov 2025</span>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-slate-100 text-slate-600 text-sm uppercase tracking-wider">
                            <th class="p-4 font-semibold border-b">Tanggal</th>
                            <th class="p-4 font-semibold border-b">Hari</th>
                            <th class="p-4 font-semibold border-b text-center text-green-700">Masuk</th>
                            <th class="p-4 font-semibold border-b text-center text-orange-700">Pulang</th>
                            <th class="p-4 font-semibold border-b text-center">Durasi</th>
                            <th class="p-4 font-semibold border-b">Catatan</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody" class="text-sm text-slate-700">
                        <!-- Data will be populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <!-- JavaScript Logic -->
    <script>
        // Data Transcription from Image
        // Note: 28 Nov Pulang 01.31 is actually 29 Nov early morning
        const rawData = [
            { date: "2025-11-28", day: "Jumat", in: "06:25", out: "01:31", nextDay: true, note: "Pulang Dini Hari (Tgl 29)" },
            { date: "2025-11-27", day: "Kamis", in: "06:16", out: "21:20", nextDay: false, note: "" },
            { date: "2025-11-26", day: "Rabu", in: "06:22", out: "20:19", nextDay: false, note: "" },
            { date: "2025-11-25", day: "Selasa", in: "06:28", out: "19:10", nextDay: false, note: "" },
            { date: "2025-11-24", day: "Senin", in: "06:11", out: "19:14", nextDay: false, note: "" },
            { date: "2025-11-21", day: "Jumat", in: "06:02", out: "19:56", nextDay: false, note: "" },
            { date: "2025-11-20", day: "Kamis", in: "06:33", out: "19:37", nextDay: false, note: "" },
            { date: "2025-11-19", day: "Rabu", in: "06:13", out: "19:29", nextDay: false, note: "" },
            { date: "2025-11-18", day: "Selasa", in: "06:14", out: "19:08", nextDay: false, note: "" },
            { date: "2025-11-17", day: "Senin", in: "06:14", out: "17:36", nextDay: false, note: "" },
            { date: "2025-11-14", day: "Jumat", in: "06:16", out: "17:46", nextDay: false, note: "" },
            { date: "2025-11-13", day: "Kamis", in: "06:18", out: "19:40", nextDay: false, note: "" },
            { date: "2025-11-12", day: "Rabu", in: "06:30", out: "17:31", nextDay: false, note: "" },
            { date: "2025-11-11", day: "Selasa", in: "06:23", out: "19:12", nextDay: false, note: "" },
            { date: "2025-11-10", day: "Senin", in: "06:21", out: "19:48", nextDay: false, note: "" },
            { date: "2025-11-07", day: "Jumat", in: "06:30", out: "22:00", nextDay: false, note: "" },
            { date: "2025-11-06", day: "Kamis", in: "06:17", out: "17:30", nextDay: false, note: "" },
            { date: "2025-11-05", day: "Rabu", in: "06:32", out: "18:56", nextDay: false, note: "" },
            { date: "2025-11-04", day: "Selasa", in: "06:28", out: "17:55", nextDay: false, note: "" },
            { date: "2025-11-03", day: "Senin", in: "06:40", out: "17:24", nextDay: false, note: "" },
            { date: "2025-10-31", day: "Jumat", in: "06:43", out: "18:33", nextDay: false, note: "" }
        ];

        // Helper: Convert time string "HH:MM" to decimal hours for chart
        function timeToDecimal(timeStr) {
            const [h, m] = timeStr.split(':').map(Number);
            return h + (m / 60);
        }

        // Helper: Calculate duration in decimal hours
        function calculateDuration(inTime, outTime, isNextDay) {
            let start = timeToDecimal(inTime);
            let end = timeToDecimal(outTime);
            if (isNextDay) end += 24; // Handle past midnight
            return end - start;
        }

        // Helper: Format decimal hours back to "HH Jam MM Menit"
        function formatDuration(decimalHours) {
            const h = Math.floor(decimalHours);
            const m = Math.round((decimalHours - h) * 60);
            return `${h}j ${m}m`;
        }

        // --- Logic Processing ---
        let totalDays = rawData.length;
        let totalIn = 0, totalOut = 0, totalDuration = 0;
        
        // Reverse data for chart so it goes Oct -> Nov
        const sortedData = [...rawData].reverse();

        const labels = sortedData.map(d => {
            const dateParts = d.date.split('-');
            return `${dateParts[2]}/${dateParts[1]}`; // DD/MM format
        });

        const inData = sortedData.map(d => timeToDecimal(d.in));
        const outData = sortedData.map(d => {
            let t = timeToDecimal(d.out);
            if (d.nextDay) t += 24;
            return t;
        });
        const durationData = sortedData.map(d => calculateDuration(d.in, d.out, d.nextDay));

        // Calculate Averages
        sortedData.forEach(d => {
            totalIn += timeToDecimal(d.in);
            // For average "Out" time, we treat next day times (e.g., 25.5) as regular math first
            let tOut = timeToDecimal(d.out);
            if(d.nextDay) tOut += 24;
            totalOut += tOut;
            totalDuration += calculateDuration(d.in, d.out, d.nextDay);
        });

        const avgInDec = totalIn / totalDays;
        const avgOutDec = totalOut / totalDays;
        const avgDurDec = totalDuration / totalDays;

        // Populate Stats
        document.getElementById('totalDays').innerText = totalDays;
        document.getElementById('avgIn').innerText = new Date(0,0,0,0, Math.round(avgInDec * 60)).toLocaleTimeString('id-ID', {hour: '2-digit', minute:'2-digit'});
        
        // Handle avg out logic (if > 24, wrap around)
        let displayAvgOut = avgOutDec;
        if(displayAvgOut >= 24) displayAvgOut -= 24;
        const hOut = Math.floor(displayAvgOut);
        const mOut = Math.round((displayAvgOut - hOut) * 60);
        document.getElementById('avgOut').innerText = `${String(hOut).padStart(2, '0')}:${String(mOut).padStart(2, '0')}`;
        
        document.getElementById('avgDuration').innerText = formatDuration(avgDurDec);

        // --- Render Table ---
        const tableBody = document.getElementById('dataTableBody');
        rawData.forEach((row, index) => {
            const dur = calculateDuration(row.in, row.out, row.nextDay);
            const tr = document.createElement('tr');
            tr.className = index % 2 === 0 ? 'bg-white hover:bg-slate-50' : 'bg-slate-50 hover:bg-slate-100';
            
            const noteHtml = row.note ? `<span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded font-bold">${row.note}</span>` : '-';
            const dateStr = new Date(row.date).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
            
            // Highlight specific row for long shift
            const durationClass = dur > 12 ? 'text-red-600 font-bold' : 'text-slate-600';

            tr.innerHTML = `
                <td class="p-4 border-b font-medium">${dateStr}</td>
                <td class="p-4 border-b">${row.day}</td>
                <td class="p-4 border-b text-center font-mono bg-green-50 text-green-700 rounded">${row.in}</td>
                <td class="p-4 border-b text-center font-mono bg-orange-50 text-orange-700 rounded">${row.out} ${row.nextDay ? '<sup class="text-xs text-red-500">(+1)</sup>' : ''}</td>
                <td class="p-4 border-b text-center ${durationClass}">${formatDuration(dur)}</td>
                <td class="p-4 border-b text-xs">${noteHtml}</td>
            `;
            tableBody.appendChild(tr);
        });

        // --- Render Charts ---
        
        // 1. Time Chart (Line)
        new Chart(document.getElementById('timeChart'), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Jam Masuk',
                        data: inData,
                        borderColor: '#16a34a', // Green
                        backgroundColor: '#16a34a',
                        borderWidth: 2,
                        pointRadius: 4,
                        tension: 0.3
                    },
                    {
                        label: 'Jam Pulang',
                        data: outData,
                        borderColor: '#ea580c', // Orange
                        backgroundColor: '#ea580c',
                        borderWidth: 2,
                        pointRadius: 4,
                        tension: 0.3
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        min: 5, // Start at 5 AM
                        max: 26, // End at 2 AM next day (26)
                        ticks: {
                            callback: function(value) {
                                if(value >= 24) return (value-24).toFixed(0) + ":00 (+1)";
                                return value.toFixed(0) + ":00";
                            }
                        },
                        grid: { color: '#e2e8f0' }
                    },
                    x: { grid: { display: false } }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let val = context.raw;
                                let label = context.dataset.label || '';
                                let h = Math.floor(val);
                                if(h >= 24) h -= 24;
                                let m = Math.round((val - Math.floor(val)) * 60);
                                return `${label}: ${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
                            }
                        }
                    }
                }
            }
        });

        // 2. Duration Chart (Bar)
        new Chart(document.getElementById('durationChart'), {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Durasi Kerja (Jam)',
                    data: durationData,
                    backgroundColor: durationData.map(d => d > 12 ? '#ef4444' : '#6366f1'), // Red if > 12 hours
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'Jam' },
                        grid: { color: '#e2e8f0' }
                    },
                    x: { grid: { display: false } }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `Durasi: ${formatDuration(context.raw)}`;
                            }
                        }
                    }
                }
            }
        });

    </script>
</body>
</html>
